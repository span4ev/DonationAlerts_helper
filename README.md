# DonationAlerts_helper

Этот скрипт предназначен для:

Скрипт выполняет 2 функции:

1. Читает файл `donations.txt`, подсчитывает все донаты от одних и тех же пользователей, суммирует их, и сортирует донатеров по разным категориям.
- Выводит (по желанию) только установленное вами кол-во строк с донатами
- Выводит (по желанию) установленную вами минимальную сумму доната для вывода.
- Подсчитывает сумму всех донатов в отдельной строке


Есть нюанс:
Скрипт чувствителен к регистру в никах, так что для него span4ev, Span4ev, spaN4ev - разные люди.
В случае с, например, Span4ev и span4ev - донаты не будут просуммированы. 
Это обусловлено тем, что нельзя предугадать какой из ников будет истинно верным (оригинальным). К тому же не исключено, что span4ev и Span4ev (как пример) - действительно разные люди, т.к. указанный никнейм при отправке доната не является уникальным, как ник на твиче и можно выбрать абсолютно любое имя.

2. Считывает HTML файл со всеми донатами (то же, что и окно в ОБС со всеми донатами с DA) и сохраняет в файл всю информацию:
- Имя отправителя
- Сумма доната
- Покрытие комиссии (символ сердца)
- Сообщение с донатом (если есть)
- Названия видео (если есть), если включена опция "прикрепить видеоролик к сообщению"
- Ссылка на видео (если есть), если включена опция "прикрепить видеоролик к сообщению"
- Кол-во прошедших дней с отправки доната.


> Учтите, что скрипт находится в стадии тестирования. Из-за отсутствия получения опыта всех возможных донатов, стикеров к сообщению и прочего возможного - скрипт не умеет с этим работать и могут возникнуть непредвиденные результаты или конечный файл не будет создан. Чтобы обрабатывать такие обстоятельства я должен с ними столкнуться или получить чужой файл с донатами, в котором есть новые условия, которые нужно обрабатывать.
На всякий случай сообщаю, что скрипт не собирает никаких данных, так что если у вас возникли ошибки или образовалась какая-то нестандартная ситуация, вы можете со мной связаться. Как-то...



### Опция 1
1. Для этой опции вам понадобится файл с вашими донатами с сайта [Donation Alerts](https://www.donationalerts.com/dashboard).

Для того чтобы получить этот файл, перейдите на страницу [Donation Alerts](https://www.donationalerts.com/dashboard/activity-feed/donations) или выберите в боковом меню пункт `Последние сообщения`. Далее - `Экспорт`. При экспорте выберите формат `.txt HTML список`.

Поместите скачанный файл `donations.txt` в папку проекта и запустите исполняемый файл `DonationAlerts_helper.exe`.





2. Для этой опции вам понадобится HTML файл с вашими донатами.  Как правило, файл называется "Last alerts - DonationAlerts.html". Название не так важно, т.к. скрипт ищет файл не по названию, а по расширению .HTML

    Получить этот файл довольно просто:

    - Откройте ОБС.
    - Включите отображение окна с донатами, если оно не включено. Отобразить окно можно через Док-панели.
    - Нажмите ПКМ по окну с донатами и выберите "Копировать текущий адрес"
    - Вставьте скопированную в буфер обмена ссылку в любой браузер и перейдите по ней. Во вкладке браузера откроется такое же окно с донатами, как в ОБС
    - Нажмите ПКМ в любом месте страницы (или CTRL+S) и обязательно сохраните HTML в том виде, который предлагает браузер по умолчанию, то есть "Веб-страница полностью (*.htm;*.html)". Другие варианты работать не будут из-за специфики разметки. Вместе с HMTL файлом скачается папка, её можно сразу же удалятья.
    - Поместите скачанный HTML файл в папку проекта 

    (Необходимо подключение к интернету, т.к. информация о донатах подгружается с сайта DA динамически)





Скрипт считывает информацию из файла с донатами (предварительно экспортированный) с сайта [Donation Alerts](https://www.donationalerts.com/dashboard). Результат сохраняется в отдельный файл (с именем `donations_result.txt`) в папку проекта.



### Содержимое папки

- `__main__.py` - Скрипт для запуска
- `class.ui` - Файл PyQt5 Designer
- `config.txt` - Файл конфигурации, в который скрипт записывает текущие настройки
- `da.py` - Основной скрипт
- `DonationAlerts_helper.exe` - Исполняемый файл скрипта
- `README.md` - Ридми файл
- `widget.py` - Виджет PyQt5



- `config.txt`
При желании, вы можете менять настройки напрямую в этом файле. Скрипт считывает настройки из этого файла и использует их для установления значений при открытии графического интерфейса.


### Запуск скрипта

Запустите файл `DonationAlerts_helper.exe`. Откроется окно с графическим интерфейсом, в котором вы можете выбрать действия скрипта и различные настройки. После нажатия кнопки "OK" скрипт выполнит выбранную вами функцию, создаст текстовый файл (в зависимости от выбранной опции) и окно автоматически закроется. Скрипт может выполнять только 1 функцию за раз. Если вам нужно создать файл с суммированными донатами и файл с информацией о донатах, запустите скрипт дважды,  

После окончания работы скрипта можно скопировать данные из файла `donations_result.txt` и вставить их, например, в панель твича. 


При выборе первой опции в папке проекта будет создан файл `_DONATION_SUMMATION_RESULT_.txt`
При выборе второй опции, в папке проекта будет создан файл `_FULL_DOTATIONS_INFO_.txt`

Вы можете запускать `DonationAlerts_helper.exe` любое кол-во раз. При каждом запуске создаваемые скриптом файлы и файл `config.txt` будут перезаписываться.


В папке присутствуют все скрипты, на основе которых был скомпилирован .exe файл, если вы хотите изучить скрипты или скомпилировать собственный экзешник. 



### Настройки графического интерфейса

Кнопки:
- `ОК` - применяет текущие настройки и запускает скрипт. Так же записывает выбранные настройки в файл `config.txt`
- `Cancel` - закрывает окно без применения изменений.
- `RESET` - сбрасывает все настройки на установленные по умолчанию и записывает их в файл `config.txt`


Установленные настройки по умолчанию:

- По умолчанию все донаты от каждого донатера суммируются - это неизменно.
- По умолчанию происходит сортировка по большей сумме (настраиваемая опция). Доступны 5 вариантов.
- По умолчанию после суммы указан символ рубля (настраиваемая опция)
- По умолчанию включена генерация строки с общей суммой всех донатов (настраиваемая опция)



### Дополнительная информация после суммы доната (по умолчанию указан символ рубля - "₽")

Для того чтобы указать любое другое слово/символ, укажите его в соответствующем поле без кавычек. Или оставьте поле пустым, чтобы ничего не указывать после суммы доната.



### Генерация строки с общей суммой всех донатов

В последней строке будет указана общая сумма всех имеющихся в файле `donations.txt` донатов.
Доступны два варианта: ВКЛ и ВЫКЛ.

Результат:
```sh
    НеПалатка - 20 ₽ 
    Это я - 100 ₽ 
    Rosie from America - 60 ₽ 
    Аноним - 40 ₽ 

    Общая сумма - 220 ₽
```


### Сортировка

По умолчанию донаты сортируются по наибольшей сумме.

Варианты на выбор:
```sh
    0 - Сортировка по умолчанию
    1 - Сортировка по умолчанию (инвертированная)
    2 - Сортировка по большей сумме
    3 - Сортировка по меньшей сумме
    4 - Сортировка по алфавиту
```

> Если у вас есть предложения о том, какие можно добавить методы сортировки, дайте мне знать.


Пример донатов в порядке поступления:
```sh
    Аноним - 10
    Аноним - 10
    Это я - 100
    Rosie from America - 15
    Rosie from America - 15
    НеПалатка - 20
    Rosie from America - 15
    Аноним - 10
    Rosie from America - 15
    Аноним - 10
 ```

Варианты сортировки:

```sh
1 - Сортировка по умолчанию - в порядке получения доната.
 ```
Результат:
 ```sh
    Аноним - 40  
    Rosie from America - 60  
    Это я - 100  
    НеПалатка - 20
 ```


```sh
2 - Сортировка по умолчанию - в порядке получения доната (то же, что и 1, но инвертированная)
 ```
Результат:
```sh
    НеПалатка - 20  
    Это я - 100  
    Rosie from America - 60  
    Аноним - 40  
 ```

```sh
3 - Сортировка по большей сумме
 ```
Результат:
```sh
    Rosie from America - 60  
    Аноним - 40  
    НеПалатка - 20  
    Это я - 100  
 ```
 
```sh
4 - Сортировка по меньшей сумме
 ```
 
Результат:
```sh
    НеПалатка - 20  
    Аноним - 40  
    Rosie from America - 60  
    Это я - 100  
 ```
 
```sh
5 - Сортировка по алфавиту
 ```
 
Результат:
```sh
    Rosie from America - 60  
    Аноним - 40  
    НеПалатка - 20  
    Это я - 100  
 ```